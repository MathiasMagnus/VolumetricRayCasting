//#include "qtfirst.h"
#include "MainWindow.h"

#include <QtWidgets/QApplication>
#include <QtWidgets/QGraphicsScene>
#include <QtWidgets/QGraphicsView>
#include <QtWidgets/QGraphicsPixmapItem>


#include "Scene.h"
#include "SceneData.h"
#include <fstream>
#include <sstream>
#include <iostream>
#include <algorithm>
#include <array>
#include <tuple>


const std::vector<unsigned char>  Raycast()
{
	Scene scene;
	// Init with camera position, viewed posisiton, field of view
	scene.Init(QVector3D(-2.5, -0.0, -2.5), QVector3D(3, 3, -3), 120.0);

	std::array<std::array<float, 2>, 3 > extent = { { { -3.0, 3.0 },{ -3.0, 3.0 },{ -3.0, 3.0 } } };
	scene.SetLimits(extent);

	scene.m_densityFunc = [](const float& x, const float& y, const float& z)
	{
		//return std::exp(-x*x - y*y - z*z);
		return 1;
	};

	//Raycast scene
	std::cout << "Raycasting scene...";
	scene.Raycast();
	std::cout << "done\n";

	return scene.GetRGBData();

}

// #Q: Letrejon-e egy QtFirst object ha includolom a headert vagy mire kell így?
// #Q: Mindenhova be kell includolni a Q_OBJECTET?
// igy kell majd strukturalni
// # Kell nekem a QMainWindow vagy elegy a QGraphicsView? Lehet azert kell a QMainWindow,
// hogy esetleg tudjuk menubart hozzaadni meg ilyenek?
// The graphics view is a widget.
// Kell delete-t hivjak a Qt-s pointerekre, vagy megoldja a tisztogatast a qt?
// Ezt nem is kell meghivni??? view->show(), meghivja a mainwindow.show-ja?

int main(int argc, char *argv[])
{
	try
	{
		/*
		const std::vector<uchar> v = Raycast();

		QApplication a(argc, argv);
		QGraphicsScene scene;
		QGraphicsView view(&scene);
		const uchar* pixDataRGB = &v[0];
		QImage img(pixDataRGB, 400, 300, 400 * 3, QImage::Format_RGB888); // 2 pixels width, 2 pixels height, 6 bytes per line, RGB888 format
		QImage scaled = img.scaled(400, 300); // Scale image to show results better
		QPixmap pix = QPixmap::fromImage(scaled); // Create pixmap from image
		QGraphicsPixmapItem item(pix);
		scene.addItem(&item);
		view.show();
		return a.exec();
		*/

		// camera position, viewed posisiton, field of view
		QApplication a(argc, argv);
		

		std::function<float(float, float, float)> densFunction = [](const float& x, const float& y, const float& z)
		{
			//return std::exp(-x*x - y*y - z*z);
			return 1;
		};
		
		SceneData sceneData(QVector3D(-2.5, -0.0, -2.5), QVector3D(3, 3, -3), 120.0,
							{ { { -3.0, 3.0 },{ -3.0, 3.0 },{ -3.0, 3.0 } } },
							densFunction);
		MainWindow w;
		w.SetScene(sceneData);
		w.Raycast();
		w.show();
		return a.exec();

	}
	catch (const std::exception& ex)
	{
		std::cerr << ex.what() << "\nFatal error\n" << std::endl;
	}

	std::cout << "Press any key to continue...\n";
	getchar();
	return 0;
	
}
